<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml" class="js"><head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>Карта РБ</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">

    <link rel="stylesheet" level="text/css" href="/resources/script/jquery/jqGrid/ui.jqgrid.css">
    <link rel="stylesheet" level="text/css" href="/resources/script/jquery/css/jquery-ui-1.7.3.custom.css">
    <link rel="stylesheet" level="text/css" href="/resources/script/jquery/jstree_pre1.0_stable/themes/classic/style.css">
    <script type="text/javascript" src="/resources/script/jquery/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/resources/script/jquery/jqGrid/grid.locale-ru.js"></script>
    <script type="text/javascript" src="/resources/script/jquery/jqGrid/jquery.jqGrid.min.js"> </script>
    <script type="text/javascript" src="/resources/script/jquery/jquery-ui-1.8.18.custom.min.js"></script>
    <script type="text/javascript" src="/resources/script/jquery/jquery.ui.tabs.js"></script>
    <script type="text/javascript" src="/resources/script/jquery/jquery.form.js"></script>
    <script type="text/javascript" src="/resources/script/jquery/jstree_pre1.0_stable/jquery.jstree.js"> </script>
    <script type="text/javascript" src="/resources/script/injeditor.js">   </script>
    <!--<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>-->
    <link type="text/css" rel="stylesheet" href="/resources/templates/book/css/style.css?b">
    <style type="text/css">body{margin: 0;padding: 0;}</style>
<body>
<div align="center">
    <div id='txt' style="position: relative;"></div>
</div>

<script type="application/javascript">
Number.prototype.degree = function () {
    return this * Math.PI / 180;
};
function  getPageSize(){
    var xScroll, yScroll;
    if (window.innerHeight && window.scrollMaxY) {
        xScroll = document.body.scrollWidth;
        yScroll = window.innerHeight + window.scrollMaxY;
    } else if (document.body.scrollHeight > document.body.offsetHeight){ // all but Explorer Mac
        xScroll = document.body.scrollWidth;
        yScroll = document.body.scrollHeight;
    } else if (document.documentElement && document.documentElement.scrollHeight > document.documentElement.offsetHeight){ // Explorer 6 strict mode
        xScroll = document.documentElement.scrollWidth;
        yScroll = document.documentElement.scrollHeight;
    } else { // Explorer Mac...would also work in Mozilla and Safari
        xScroll = document.body.offsetWidth;
        yScroll = document.body.offsetHeight;
    }
    var windowWidth, windowHeight;
    if (self.innerHeight) { // all except Explorer
        windowWidth = self.innerWidth;
        windowHeight = self.innerHeight;
    } else if (document.documentElement && document.documentElement.clientHeight) { // Explorer 6 Strict Mode
        windowWidth = document.documentElement.clientWidth;
        windowHeight = document.documentElement.clientHeight;
    } else if (document.body) { // other Explorers
        windowWidth = document.body.clientWidth;
        windowHeight = document.body.clientHeight;
    }
    // for small pages with total height less then height of the viewport
    if(yScroll < windowHeight){
        pageHeight = windowHeight;
    } else {
        pageHeight = yScroll;
    }
    // for small pages with total width less then width of the viewport
    if(xScroll < windowWidth){
        pageWidth = windowWidth;
    } else {
        pageWidth = xScroll;
    }
    return [pageWidth,pageHeight,windowWidth,windowHeight];
}

var Class={create:function(){return function(){this.initialize.apply(this, arguments);}}}
Object.extend = function(d,s){for (var property in s) {d[property] = s[property];}return d;}
if (typeof KeyEvent == "undefined") {
    var KeyEvent = {DOM_VK_CANCEL: 3,DOM_VK_HELP: 6,DOM_VK_BACK_SPACE: 8,DOM_VK_TAB: 9,DOM_VK_CLEAR: 12,DOM_VK_RETURN: 13,DOM_VK_ENTER: 14,DOM_VK_SHIFT: 16,DOM_VK_CONTROL: 17,DOM_VK_ALT: 18,DOM_VK_PAUSE: 19,DOM_VK_CAPS_LOCK: 20,DOM_VK_ESCAPE: 27,DOM_VK_SPACE: 32,DOM_VK_PAGE_UP: 33,DOM_VK_PAGE_DOWN: 34,DOM_VK_END: 35,DOM_VK_HOME: 36,DOM_VK_LEFT: 37,DOM_VK_UP: 38,DOM_VK_RIGHT: 39,DOM_VK_DOWN: 40,DOM_VK_PRINTSCREEN: 44,DOM_VK_INSERT: 45,DOM_VK_DELETE: 46,DOM_VK_0: 48,DOM_VK_1: 49,DOM_VK_2: 50,DOM_VK_3: 51,DOM_VK_4: 52,DOM_VK_5: 53,DOM_VK_6: 54,DOM_VK_7: 55,DOM_VK_8: 56,DOM_VK_9: 57,DOM_VK_SEMICOLON: 59,DOM_VK_EQUALS: 61,DOM_VK_A: 65,DOM_VK_B: 66,DOM_VK_C: 67,DOM_VK_D: 68,DOM_VK_E: 69,DOM_VK_F: 70,DOM_VK_G: 71,DOM_VK_H: 72,DOM_VK_I: 73,DOM_VK_J: 74,DOM_VK_K: 75,DOM_VK_L: 76,DOM_VK_M: 77,DOM_VK_N: 78,DOM_VK_O: 79,DOM_VK_P: 80,DOM_VK_Q: 81,DOM_VK_R: 82,DOM_VK_S: 83,DOM_VK_T: 84,DOM_VK_U: 85,DOM_VK_V: 86,DOM_VK_W: 87,DOM_VK_X: 88,DOM_VK_Y: 89,DOM_VK_Z: 90,DOM_VK_CONTEXT_MENU: 93,DOM_VK_NUMPAD0: 96,DOM_VK_NUMPAD1: 97,DOM_VK_NUMPAD2: 98,DOM_VK_NUMPAD3: 99,DOM_VK_NUMPAD4: 100,DOM_VK_NUMPAD5: 101,DOM_VK_NUMPAD6: 102,DOM_VK_NUMPAD7: 103,DOM_VK_NUMPAD8: 104,DOM_VK_NUMPAD9: 105,DOM_VK_MULTIPLY: 106,DOM_VK_ADD: 107,DOM_VK_SEPARATOR: 108,DOM_VK_SUBTRACT: 109,DOM_VK_DECIMAL: 110,DOM_VK_DIVIDE: 111,DOM_VK_F1: 112,DOM_VK_F2: 113,DOM_VK_F3: 114,DOM_VK_F4: 115,DOM_VK_F5: 116,DOM_VK_F6: 117,DOM_VK_F7: 118,DOM_VK_F8: 119,DOM_VK_F9: 120,DOM_VK_F10: 121,DOM_VK_F11: 122,DOM_VK_F12: 123,DOM_VK_F13: 124,DOM_VK_F14: 125,DOM_VK_F15: 126,DOM_VK_F16: 127,DOM_VK_F17: 128,DOM_VK_F18: 129,DOM_VK_F19: 130,DOM_VK_F20: 131,DOM_VK_F21: 132,DOM_VK_F22: 133,DOM_VK_F23: 134,DOM_VK_F24: 135,DOM_VK_NUM_LOCK: 144,DOM_VK_SCROLL_LOCK: 145,DOM_VK_COMMA: 188,DOM_VK_PERIOD: 190,DOM_VK_SLASH: 191,DOM_VK_BACK_QUOTE: 192,DOM_VK_OPEN_BRACKET: 219,DOM_VK_BACK_SLASH: 220,DOM_VK_CLOSE_BRACKET: 221,DOM_VK_QUOTE: 222,DOM_VK_META: 224
    };
}
var langS=[];
langS['Ru']={
    SCORE:"Вы выбили: ",  StartGame:"Начать игру",  Settings:"Настройки",  TableLider:"Таблица лидеров",  Exit:"Выход",  Lang:"Язык",  GoToMenu:"Вернуться в меню",  GameName:"ПОЦЕЛУЙ Иринку",  StudiosName:"NULAY GAME",  YourLoose:"С ДНЕМ СВЯТОГО ВАЛЕНТИНА!!!",  YouScore:"Ваш результат ",  From:" из ",  Moles:"поцелуев",  LangName:"Русский",  On:"вкл.",  Off:"выкл.",  Mouse:"Мышь",  Sound:"Звук",  Back:"Назад",  Up:"Вверх",  Right:"Вправо",  Down:"Вниз",  Left:"Влево",  Keybord:"Клавиатура",  Joystick:"Джойстик",  Action:"Действие",
    SHOW_EDGE_DEP:"Показать границы отделений",SHOW_SORT_ST:"Показать сортировочные станции",SHOW_OTHER_ST:"Показать остальные станции",SHOW_NAME:"Показать названия",SHOW_ESR:"Показать esr код",
    SHOW_KORD_MAP:"Показать координатную карту",SHOW_SHEM_MAP:"Показать схематическую карту"
}
langS['En']={
    SCORE:"SCORE: ",  StartGame:"Start Game",  Settings:"Settings",  TableLider:"Lider Table",  Exit:"Exit",  Lang:"Langvich",  GoToMenu:"Go to menu",  GameName:"KISS Irishka",  StudiosName:"NULAY GAME",  YourLoose:"Happy Valentine's Day!!!",  YouScore:"You score ",  From:" from ",  Moles:"kesses",  LangName:"English",  On:"on",  Off:"off",  Mouse:"Mouse",  Sound:"Sound",  Back:"Back",  Up:"Up",  Right:"Right",  Down:"Down",  Left:"Left",  Keybord:"Keybord",  Joystick:"Joystick",  Action:"Action",
    SHOW_EDGE_DEP:"Show edge department",SHOW_SORT_ST:"Show sort station",SHOW_OTHER_ST:"Show other station",SHOW_NAME:"Show name",SHOW_ESR:"Show ESR",
    SHOW_KORD_MAP:"Show coordinat map",SHOW_SHEM_MAP:"Show shem map"
}

var LayerMapRB=Class.create();
LayerMapRB.prototype = {
    size: getPageSize(),
    t3:[{'x':2.366603,'y':5.148658},{'x':2.361855,'y':5.149246},{'x':2.355272,'y':5.152814},{'x':2.354572,'y':5.154320},{'x':2.355348,'y':5.155884},{'x':2.353797,'y':5.158047},{'x':2.352397,'y':5.160010},{'x':2.352094,'y':5.163475},{'x':2.352284,'y':5.165940},{'x':2.353191,'y':5.168696},{'x':2.353135,'y':5.170408},{'x':2.351054,'y':5.172506},{'x':2.351432,'y':5.174661},{'x':2.354856,'y':5.176886},{'x':2.361193,'y':5.179425},{'x':2.358620,'y':5.182840},{'x':2.358885,'y':5.187759},{'x':2.360190,'y':5.190293},{'x':2.359453,'y':5.191681},{'x':2.361136,'y':5.195297},{'x':2.364957,'y':5.198082},{'x':2.364200,'y':5.201809},{'x':2.362763,'y':5.205893},{'x':2.360342,'y':5.208834},{'x':2.358753,'y':5.210682},{'x':2.355064,'y':5.209950},{'x':2.353532,'y':5.210752},{'x':2.350165,'y':5.213400},{'x':2.347895,'y':5.214665},{'x':2.347403,'y':5.216557},{'x':2.346003,'y':5.216777},{'x':2.342618,'y':5.216464},{'x':2.339440,'y':5.217288},{'x':2.336754,'y':5.219097},{'x':2.334711,'y':5.219793},{'x':2.330814,'y':5.220175},{'x':2.326009,'y':5.220975},{'x':2.319862,'y':5.222065},{'x':2.318803,'y':5.222598},{'x':2.318292,'y':5.224011},{'x':2.318784,'y':5.226906},{'x':2.316722,'y':5.228063},{'x':2.317459,'y':5.229753},{'x':2.323191,'y':5.236203},{'x':2.326823,'y':5.239852},{'x':2.330247,'y':5.243128},{'x':2.335694,'y':5.248534},{'x':2.341350,'y':5.252852},{'x':2.346003,'y':5.255774},{'x':2.353191,'y':5.258763},{'x':2.361420,'y':5.260762},{'x':2.366981,'y':5.261853},{'x':2.371805,'y':5.262220},{'x':2.373923,'y':5.262083},{'x':2.383570,'y':5.266742},{'x':2.391969,'y':5.271397},{'x':2.392499,'y':5.276173},{'x':2.392461,'y':5.281184},{'x':2.391061,'y':5.282807},{'x':2.391212,'y':5.285732},{'x':2.390929,'y':5.289830},{'x':2.390493,'y':5.291005},{'x':2.390758,'y':5.294335},{'x':2.392915,'y':5.296079},{'x':2.391647,'y':5.297845},{'x':2.390172,'y':5.302910},{'x':2.388942,'y':5.304434},{'x':2.387353,'y':5.306003},{'x':2.386048,'y':5.308322},{'x':2.387524,'y':5.311717},{'x':2.389283,'y':5.313624},{'x':2.390323,'y':5.314952},{'x':2.389623,'y':5.316789},{'x':2.386029,'y':5.319011},{'x':2.384894,'y':5.320858},{'x':2.384440,'y':5.322534},{'x':2.380998,'y':5.323757},{'x':2.380203,'y':5.324561},{'x':2.373129,'y':5.337129},{'x':2.369194,'y':5.344436},{'x':2.366811,'y':5.348670},{'x':2.365090,'y':5.351562},{'x':2.363765,'y':5.354676},{'x':2.361325,'y':5.359630},{'x':2.359415,'y':5.365116},{'x':2.357277,'y':5.370337},{'x':2.357107,'y':5.373941},{'x':2.353456,'y':5.376580},{'x':2.353456,'y':5.382658},{'x':2.351224,'y':5.385940},{'x':2.349787,'y':5.391102},{'x':2.349919,'y':5.395768},{'x':2.351451,'y':5.396535},{'x':2.353475,'y':5.396268},{'x':2.358980,'y':5.395011},{'x':2.361060,'y':5.394042},{'x':2.363501,'y':5.393708},{'x':2.370897,'y':5.394654},{'x':2.372807,'y':5.394510},{'x':2.377347,'y':5.393051},{'x':2.378463,'y':5.392706},{'x':2.379314,'y':5.393797},{'x':2.382776,'y':5.396068},{'x':2.385008,'y':5.396446},{'x':2.387335,'y':5.395912},{'x':2.388488,'y':5.395100},{'x':2.389737,'y':5.396814},{'x':2.391231,'y':5.397626},{'x':2.393142,'y':5.397537},{'x':2.396395,'y':5.396435},{'x':2.398325,'y':5.394710},{'x':2.398779,'y':5.393296},{'x':2.403735,'y':5.394087},{'x':2.409334,'y':5.394654},{'x':2.410544,'y':5.396335},{'x':2.415330,'y':5.397147},{'x':2.420381,'y':5.397948},{'x':2.422234,'y':5.397426},{'x':2.422915,'y':5.395779},{'x':2.423672,'y':5.395489},{'x':2.425204,'y':5.396179},{'x':2.427058,'y':5.395990},{'x':2.429290,'y':5.393730},{'x':2.431673,'y':5.392160},{'x':2.432789,'y':5.391547},{'x':2.434681,'y':5.392349},{'x':2.436459,'y':5.392004},{'x':2.437064,'y':5.391035},{'x':2.441415,'y':5.391692},{'x':2.444650,'y':5.392093},{'x':2.446825,'y':5.393942},{'x':2.452140,'y':5.396702},{'x':2.456756,'y':5.399183},{'x':2.464757,'y':5.401407},{'x':2.467727,'y':5.402351},{'x':2.470053,'y':5.402351},{'x':2.471907,'y':5.401462},{'x':2.472513,'y':5.400662},{'x':2.471926,'y':5.399294},{'x':2.471283,'y':5.398126},{'x':2.472664,'y':5.398049},{'x':2.474083,'y':5.400150},{'x':2.475634,'y':5.401062},{'x':2.477525,'y':5.400451},{'x':2.478320,'y':5.400050},{'x':2.482179,'y':5.401162},{'x':2.482481,'y':5.402607},{'x':2.481025,'y':5.404284},{'x':2.480268,'y':5.405894},{'x':2.479663,'y':5.408137},{'x':2.478622,'y':5.409113},{'x':2.478263,'y':5.411143},{'x':2.482897,'y':5.415642},{'x':2.496328,'y':5.417757},{'x':2.498654,'y':5.416894},{'x':2.499789,'y':5.415288},{'x':2.502078,'y':5.414922},{'x':2.505445,'y':5.414878},{'x':2.507828,'y':5.415111},{'x':2.510042,'y':5.416550},{'x':2.512633,'y':5.418554},{'x':2.515414,'y':5.420613},{'x':2.519575,'y':5.423720},{'x':2.520294,'y':5.425909},{'x':2.522696,'y':5.427035},{'x':2.526687,'y':5.428250},{'x':2.528352,'y':5.428195},{'x':2.530565,'y':5.426991},{'x':2.533592,'y':5.427510},{'x':2.537923,'y':5.428571},{'x':2.539872,'y':5.428681},{'x':2.542501,'y':5.430392},{'x':2.549897,'y':5.431992},{'x':2.552640,'y':5.431154},{'x':2.553151,'y':5.429785},{'x':2.553340,'y':5.428990},{'x':2.556915,'y':5.428184},{'x':2.559071,'y':5.425621},{'x':2.560036,'y':5.422604},{'x':2.557747,'y':5.419296},{'x':2.553548,'y':5.417946},{'x':2.556896,'y':5.415952},{'x':2.562987,'y':5.415166},{'x':2.568151,'y':5.416351},{'x':2.570345,'y':5.417536},{'x':2.576077,'y':5.417004},{'x':2.574469,'y':5.420679},{'x':2.573561,'y':5.422515},{'x':2.575755,'y':5.423698},{'x':2.573769,'y':5.426108},{'x':2.569967,'y':5.426583},{'x':2.568624,'y':5.427952},{'x':2.569362,'y':5.429962},{'x':2.567243,'y':5.431595},{'x':2.564708,'y':5.430260},{'x':2.560660,'y':5.430315},{'x':2.558277,'y':5.430812},{'x':2.555345,'y':5.430613},{'x':2.553699,'y':5.431264},{'x':2.552281,'y':5.433393},{'x':2.552489,'y':5.435058},{'x':2.555818,'y':5.437274},{'x':2.557199,'y':5.439510},{'x':2.558996,'y':5.441337},{'x':2.561644,'y':5.442636},{'x':2.559242,'y':5.445584},{'x':2.559923,'y':5.447255},{'x':2.562684,'y':5.447981},{'x':2.564349,'y':5.450870},{'x':2.567073,'y':5.454383},{'x':2.574072,'y':5.457279},{'x':2.573977,'y':5.461093},{'x':2.572899,'y':5.463261},{'x':2.571896,'y':5.468426},{'x':2.572464,'y':5.470546},{'x':2.572918,'y':5.477066},{'x':2.572067,'y':5.480818},{'x':2.574091,'y':5.482910},{'x':2.576550,'y':5.483292},{'x':2.576852,'y':5.485873},{'x':2.583965,'y':5.490574},{'x':2.584419,'y':5.493541},{'x':2.594501,'y':5.495627},{'x':2.599494,'y':5.496616},{'x':2.604734,'y':5.495497},{'x':2.606928,'y':5.497441},{'x':2.611790,'y':5.499492},{'x':2.617805,'y':5.500132},{'x':2.619318,'y':5.500349},{'x':2.622534,'y':5.506799},{'x':2.625050,'y':5.507882},{'x':2.620926,'y':5.510404},{'x':2.621626,'y':5.511595},{'x':2.629892,'y':5.514125},{'x':2.632389,'y':5.515368},{'x':2.635586,'y':5.515855},{'x':2.641393,'y':5.514839},{'x':2.644287,'y':5.514460},{'x':2.646179,'y':5.513823},{'x':2.647143,'y':5.515368},{'x':2.651608,'y':5.516870},{'x':2.655599,'y':5.515747},{'x':2.659571,'y':5.516363},{'x':2.664716,'y':5.516957},{'x':2.666948,'y':5.517529},{'x':2.666267,'y':5.520110},{'x':2.671431,'y':5.522474},{'x':2.671621,'y':5.524803},{'x':2.674307,'y':5.526323},{'x':2.679584,'y':5.528177},{'x':2.681967,'y':5.528414},{'x':2.681778,'y':5.529879},{'x':2.677239,'y':5.531117},{'x':2.671961,'y':5.531461},{'x':2.663733,'y':5.531375},{'x':2.658814,'y':5.531095},{'x':2.655920,'y':5.531074},{'x':2.650719,'y':5.532161},{'x':2.644457,'y':5.533485},{'x':2.642793,'y':5.534593},{'x':2.643285,'y':5.535743},{'x':2.646046,'y':5.536163},{'x':2.646481,'y':5.537410},{'x':2.652326,'y':5.539559},{'x':2.653632,'y':5.541041},{'x':2.652591,'y':5.543875},{'x':2.653234,'y':5.545709},{'x':2.655202,'y':5.547114},{'x':2.651191,'y':5.549429},{'x':2.651286,'y':5.551358},{'x':2.653669,'y':5.553328},{'x':2.658096,'y':5.555511},{'x':2.661614,'y':5.557939},{'x':2.662825,'y':5.559126},{'x':2.661765,'y':5.561413},{'x':2.661576,'y':5.566089},{'x':2.661765,'y':5.569012},{'x':2.663695,'y':5.571271},{'x':2.665738,'y':5.571655},{'x':2.673096,'y':5.570738},{'x':2.675252,'y':5.569065},{'x':2.677636,'y':5.568873},{'x':2.679414,'y':5.570611},{'x':2.685940,'y':5.572028},{'x':2.686034,'y':5.573753},{'x':2.691350,'y':5.579383},{'x':2.693312,'y':5.579599},{'x':2.694402,'y':5.580075},{'x':2.696551,'y':5.581827},{'x':2.700697,'y':5.583298},{'x':2.704526,'y':5.583544},{'x':2.707976,'y':5.583519},{'x':2.709111,'y':5.583544},{'x':2.709459,'y':5.584725},{'x':2.711457,'y':5.585617},{'x':2.715724,'y':5.585736},{'x':2.717858,'y':5.584674},{'x':2.720687,'y':5.583858},{'x':2.722715,'y':5.582439},{'x':2.725454,'y':5.580645},{'x':2.725923,'y':5.579922},{'x':2.728753,'y':5.579259},{'x':2.732567,'y':5.580356},{'x':2.735184,'y':5.582136},{'x':2.737359,'y':5.582519},{'x':2.744547,'y':5.580584},{'x':2.759226,'y':5.579702},{'x':2.761515,'y':5.584887},{'x':2.760569,'y':5.589398},{'x':2.763671,'y':5.593246},{'x':2.773451,'y':5.598773},{'x':2.779334,'y':5.601735},{'x':2.779031,'y':5.603627},{'x':2.781074,'y':5.604810},{'x':2.787940,'y':5.606215},{'x':2.790097,'y':5.606447},{'x':2.793502,'y':5.610711},{'x':2.796188,'y':5.612852},{'x':2.806270,'y':5.614739},{'x':2.810677,'y':5.617267},{'x':2.813552,'y':5.618162},{'x':2.816636,'y':5.617877},{'x':2.817846,'y':5.616277},{'x':2.817752,'y':5.615097},{'x':2.820816,'y':5.615002},{'x':2.826207,'y':5.612103},{'x':2.829366,'y':5.609962},{'x':2.834152,'y':5.607387},{'x':2.835060,'y':5.609751},{'x':2.835778,'y':5.611703},{'x':2.840394,'y':5.612694},{'x':2.843629,'y':5.610722},{'x':2.846806,'y':5.612177},{'x':2.854827,'y':5.612652},{'x':2.863793,'y':5.611703},{'x':2.869165,'y':5.611270},{'x':2.870527,'y':5.609509},{'x':2.867954,'y':5.607704},{'x':2.866782,'y':5.606764},{'x':2.870508,'y':5.604366},{'x':2.872248,'y':5.602179},{'x':2.874688,'y':5.598435},{'x':2.880685,'y':5.598456},{'x':2.882917,'y':5.597789},{'x':2.884222,'y':5.599757},{'x':2.893528,'y':5.602200},{'x':2.900281,'y':5.603511},{'x':2.909493,'y':5.604504},{'x':2.911139,'y':5.603257},{'x':2.913541,'y':5.603880},{'x':2.916965,'y':5.603310},{'x':2.922394,'y':5.600265},{'x':2.925345,'y':5.600498},{'x':2.930982,'y':5.600053},{'x':2.934746,'y':5.598995},{'x':2.936184,'y':5.598107},{'x':2.939343,'y':5.598350},{'x':2.944942,'y':5.597175},{'x':2.946663,'y':5.595746},{'x':2.945831,'y':5.594602},{'x':2.948649,'y':5.593352},{'x':2.950106,'y':5.591953},{'x':2.948876,'y':5.590692},{'x':2.942634,'y':5.589175},{'x':2.944431,'y':5.587233},{'x':2.943731,'y':5.586034},{'x':2.941726,'y':5.586045},{'x':2.941159,'y':5.582380},{'x':2.938870,'y':5.577670},{'x':2.940761,'y':5.576127},{'x':2.946285,'y':5.573966},{'x':2.951165,'y':5.571559},{'x':2.955156,'y':5.573934},{'x':2.956310,'y':5.575201},{'x':2.956991,'y':5.577000},{'x':2.961020,'y':5.578979},{'x':2.967395,'y':5.580329},{'x':2.974261,'y':5.581392},{'x':2.977307,'y':5.580967},{'x':2.978952,'y':5.579074},{'x':2.982225,'y':5.582295},{'x':2.984684,'y':5.585418},{'x':2.987635,'y':5.587021},{'x':2.990472,'y':5.587021},{'x':2.997433,'y':5.588061},{'x':3.002692,'y':5.587966},{'x':3.006759,'y':5.586533},{'x':3.011677,'y':5.584399},{'x':3.014571,'y':5.588252},{'x':3.017484,'y':5.588963},{'x':3.020435,'y':5.587711},{'x':3.024937,'y':5.588125},{'x':3.029212,'y':5.587806},{'x':3.031047,'y':5.586554},{'x':3.030479,'y':5.584144},{'x':3.034149,'y':5.584473},{'x':3.040996,'y':5.582720},{'x':3.048336,'y':5.582136},{'x':3.053556,'y':5.580372},{'x':3.054332,'y':5.578287},{'x':3.052384,'y':5.577532},{'x':3.054067,'y':5.576021},{'x':3.058796,'y':5.576000},{'x':3.063866,'y':5.574350},{'x':3.066760,'y':5.570738},{'x':3.068557,'y':5.567689},{'x':3.069937,'y':5.566783},{'x':3.074364,'y':5.567071},{'x':3.077901,'y':5.561017},{'x':3.079414,'y':5.560601},{'x':3.082573,'y':5.563826},{'x':3.086886,'y':5.564232},{'x':3.093677,'y':5.563282},{'x':3.096287,'y':5.561797},{'x':3.097876,'y':5.554109},{'x':3.097611,'y':5.549397},{'x':3.096779,'y':5.548454},{'x':3.092731,'y':5.545709},{'x':3.095077,'y':5.540160},{'x':3.094736,'y':5.537119},{'x':3.087718,'y':5.533657},{'x':3.084011,'y':5.530622},{'x':3.088872,'y':5.528931},{'x':3.090291,'y':5.528058},{'x':3.090064,'y':5.526528},{'x':3.095114,'y':5.522301},{'x':3.098746,'y':5.517313},{'x':3.100922,'y':5.510978},{'x':3.102700,'y':5.505965},{'x':3.101735,'y':5.502508},{'x':3.098065,'y':5.500187},{'x':3.097649,'y':5.498298},{'x':3.095682,'y':5.496094},{'x':3.084049,'y':5.493628},{'x':3.085600,'y':5.490943},{'x':3.083916,'y':5.487691},{'x':3.081041,'y':5.486853},{'x':3.077107,'y':5.481177},{'x':3.084484,'y':5.479695},{'x':3.086073,'y':5.478746},{'x':3.091937,'y':5.476466},{'x':3.094490,'y':5.475593},{'x':3.098727,'y':5.473234},{'x':3.101962,'y':5.473136},{'x':3.103589,'y':5.471049},{'x':3.103381,'y':5.469891},{'x':3.100600,'y':5.468404},{'x':3.106577,'y':5.468502},{'x':3.114333,'y':5.468163},{'x':3.118892,'y':5.467704},{'x':3.121710,'y':5.465603},{'x':3.123394,'y':5.463535},{'x':3.122322,'y':5.462256},{'x':3.115561,'y':5.454270},{'x':3.111800,'y':5.451540},{'x':3.120327,'y':5.449145},{'x':3.124834,'y':5.447320},{'x':3.128640,'y':5.440187},{'x':3.132356,'y':5.436674},{'x':3.133563,'y':5.434125},{'x':3.134232,'y':5.431223},{'x':3.133711,'y':5.426693},{'x':3.139504,'y':5.423895},{'x':3.142253,'y':5.423153},{'x':3.151177,'y':5.419531},{'x':3.156262,'y':5.416237},{'x':3.165546,'y':5.415328},{'x':3.170213,'y':5.412445},{'x':3.178654,'y':5.412205},{'x':3.191747,'y':5.404339},{'x':3.190793,'y':5.396077},{'x':3.184804,'y':5.386556},{'x':3.181917,'y':5.383151},{'x':3.190576,'y':5.380297},{'x':3.215216,'y':5.384273},{'x':3.247208,'y':5.375783},{'x':3.253607,'y':5.372715},{'x':3.254509,'y':5.368711},{'x':3.248984,'y':5.363834},{'x':3.254734,'y':5.356609},{'x':3.266685,'y':5.351651},{'x':3.278045,'y':5.347750},{'x':3.282244,'y':5.342994},{'x':3.275397,'y':5.332178},{'x':3.272626,'y':5.331109},{'x':3.257270,'y':5.328452},{'x':3.253865,'y':5.327486},{'x':3.244953,'y':5.318036},{'x':3.225750,'y':5.309249},{'x':3.217804,'y':5.306398},{'x':3.198231,'y':5.306290},{'x':3.184340,'y':5.309595},{'x':3.172525,'y':5.316035},{'x':3.159987,'y':5.317603},{'x':3.146999,'y':5.317171},{'x':3.143120,'y':5.311111},{'x':3.140865,'y':5.297337},{'x':3.156740,'y':5.287059},{'x':3.167651,'y':5.277406},{'x':3.174257,'y':5.257378},{'x':3.187470,'y':5.219408},{'x':3.182697,'y':5.209572},{'x':3.173809,'y':5.207903},{'x':3.142037,'y':5.210238},{'x':3.130969,'y':5.203676},{'x':3.123761,'y':5.202926},{'x':3.114742,'y':5.206531},{'x':3.097875,'y':5.206365},{'x':3.095349,'y':5.199261},{'x':3.083229,'y':5.189410},{'x':3.069244,'y':5.178979},{'x':3.064282,'y':5.170809},{'x':3.059611,'y':5.166982},{'x':3.057995,'y':5.161106},{'x':3.060824,'y':5.155977},{'x':3.064749,'y':5.147284},{'x':3.067289,'y':5.138466},{'x':3.068437,'y':5.134053},{'x':3.064576,'y':5.132374},{'x':3.064668,'y':5.130468},{'x':3.062070,'y':5.127694},{'x':3.056181,'y':5.125930},{'x':3.045109,'y':5.126094},{'x':3.043013,'y':5.128805},{'x':3.040649,'y':5.129581},{'x':3.031102,'y':5.135510},{'x':3.031545,'y':5.137503},{'x':3.034028,'y':5.138702},{'x':3.030008,'y':5.143790},{'x':3.019989,'y':5.148412},{'x':3.012364,'y':5.147731},{'x':3.004383,'y':5.149093},{'x':2.997792,'y':5.146442},{'x':2.991822,'y':5.146792},{'x':2.989871,'y':5.144416},{'x':2.988290,'y':5.143665},{'x':2.983240,'y':5.144207},{'x':2.979600,'y':5.142942},{'x':2.972975,'y':5.144961},{'x':2.972765,'y':5.146977},{'x':2.972009,'y':5.149436},{'x':2.972647,'y':5.151085},{'x':2.972836,'y':5.152056},{'x':2.970283,'y':5.151099},{'x':2.967634,'y':5.149672},{'x':2.962882,'y':5.148774},{'x':2.962007,'y':5.146815},{'x':2.959395,'y':5.145497},{'x':2.954984,'y':5.145327},{'x':2.952988,'y':5.140098},{'x':2.950044,'y':5.138441},{'x':2.942655,'y':5.139954},{'x':2.936997,'y':5.137540},{'x':2.932149,'y':5.136924},{'x':2.930929,'y':5.137782},{'x':2.925867,'y':5.145616},{'x':2.923244,'y':5.149804},{'x':2.920399,'y':5.156377},{'x':2.916668,'y':5.160647},{'x':2.913823,'y':5.163239},{'x':2.910683,'y':5.162597},{'x':2.903663,'y':5.157778},{'x':2.900523,'y':5.156193},{'x':2.897974,'y':5.156124},{'x':2.895794,'y':5.157456},{'x':2.888885,'y':5.156676},{'x':2.883528,'y':5.154379},{'x':2.880129,'y':5.150264},{'x':2.879686,'y':5.148217},{'x':2.880425,'y':5.145179},{'x':2.878245,'y':5.141678},{'x':2.875690,'y':5.140575},{'x':2.866869,'y':5.143974},{'x':2.863683,'y':5.151940},{'x':2.862251,'y':5.156048},{'x':2.854631,'y':5.156622},{'x':2.848120,'y':5.157770},{'x':2.840962,'y':5.153406},{'x':2.835235,'y':5.152630},{'x':2.833203,'y':5.153894},{'x':2.825122,'y':5.160840},{'x':2.822997,'y':5.162503},{'x':2.824475,'y':5.165627},{'x':2.820365,'y':5.163650},{'x':2.818518,'y':5.161041},{'x':2.814685,'y':5.158028},{'x':2.808820,'y':5.156163},{'x':2.794688,'y':5.154354},{'x':2.791825,'y':5.155416},{'x':2.789839,'y':5.159377},{'x':2.787299,'y':5.160926},{'x':2.785914,'y':5.159119},{'x':2.787576,'y':5.155014},{'x':2.786329,'y':5.153118},{'x':2.778525,'y':5.146333},{'x':2.774357,'y':5.146237},{'x':2.767663,'y':5.149307},{'x':2.764670,'y':5.151630},{'x':2.766702,'y':5.154756},{'x':2.769252,'y':5.156524},{'x':2.770803,'y':5.159119},{'x':2.761826,'y':5.159486},{'x':2.755730,'y':5.161436},{'x':2.753587,'y':5.158476},{'x':2.750816,'y':5.157535},{'x':2.746456,'y':5.158752},{'x':2.738809,'y':5.159647},{'x':2.730496,'y':5.158912},{'x':2.723420,'y':5.158236},{'x':2.721653,'y':5.160780},{'x':2.718766,'y':5.166297},{'x':2.718247,'y':5.176026},{'x':2.701621,'y':5.175347},{'x':2.698100,'y':5.172953},{'x':2.694971,'y':5.172269},{'x':2.679713,'y':5.174260},{'x':2.673026,'y':5.177210},{'x':2.669479,'y':5.180386},{'x':2.660613,'y':5.180934},{'x':2.655256,'y':5.178193},{'x':2.647022,'y':5.178591},{'x':2.615999,'y':5.185270},{'x':2.593131,'y':5.189692},{'x':2.540941,'y':5.191096},{'x':2.514458,'y':5.194413},{'x':2.496495,'y':5.188278},{'x':2.475658,'y':5.187024},{'x':2.447727,'y':5.186978},{'x':2.435979,'y':5.183897},{'x':2.435277,'y':5.175535},{'x':2.431841,'y':5.172378},{'x':2.408529,'y':5.160783},{'x':2.399732,'y':5.157125},{'x':2.393244,'y':5.158279},{'x':2.387731,'y':5.158341},{'x':2.385773,'y':5.159675},{'x':2.388847,'y':5.162832},{'x':2.384614,'y':5.163199},{'x':2.380784,'y':5.163081},{'x':2.378656,'y':5.163096},{'x':2.377639,'y':5.163830},{'x':2.376315,'y':5.165091},{'x':2.370687,'y':5.163947},{'x':2.363428,'y':5.161936},{'x':2.368086,'y':5.158456},{'x':2.367306,'y':5.156192},{'x':2.366313,'y':5.154943},{'x':2.367968,'y':5.152854},{'x':2.369363,'y':5.149956},{'x':2.366603,'y':5.148658}],
    t1:[{'x':738.2,'y':703.3},{'x':713.4,'y':703.9},{'x':703.8,'y':700.6},{'x':697.5,'y':705.7},{'x':686.1,'y':706.8},{'x':680.3,'y':714.7},{'x':672.6,'y':715.2},{'x':670.0,'y':703.5},{'x':664.1,'y':690.4},{'x':651.7,'y':705.4},{'x':642.2,'y':688.0},{'x':636.6,'y':686.4},{'x':632.6,'y':679.2},{'x':620.2,'y':679.5},{'x':618.1,'y':683.1},{'x':606.2,'y':691.4},{'x':581.1,'y':692.1},{'x':573.6,'y':683.5},{'x':563.1,'y':672.9},{'x':549.4,'y':674.5},{'x':536.1,'y':672.3},{'x':517.4,'y':653.3},{'x':518.1,'y':625.5},{'x':512.0,'y':616.8},{'x':501.2,'y':620.2},{'x':499.9,'y':616.5},{'x':487.4,'y':620.5},{'x':477.6,'y':638.5},{'x':466.3,'y':636.6},{'x':454.1,'y':636.1},{'x':447.5,'y':632.4},{'x':440.9,'y':633.2},{'x':436.6,'y':629.8},{'x':418.9,'y':652.5},{'x':408.1,'y':653.6},{'x':402.8,'y':643.8},{'x':397.3,'y':644.0},{'x':392.4,'y':634.5},{'x':386.6,'y':634.3},{'x':381.9,'y':624.5},{'x':371.9,'y':619.5},{'x':361.3,'y':618.9},{'x':343.3,'y':615.0},{'x':314.7,'y':593.8},{'x':307.6,'y':576.9},{'x':311.3,'y':567.0},{'x':311.0,'y':522.6},{'x':277.7,'y':511.0},{'x':260.8,'y':512.0},{'x':249.2,'y':502.5},{'x':238.1,'y':505.7},{'x':228.5,'y':516.3},{'x':218.4,'y':519.5},{'x':193.6,'y':508.9},{'x':188.8,'y':495.6},{'x':179.3,'y':484.0},{'x':178.8,'y':477.1},{'x':164.5,'y':478.2},{'x':162.9,'y':468.6},{'x':150.8,'y':458.1},{'x':140.7,'y':455.9},{'x':124.8,'y':473.4},{'x':115.8,'y':473.9},{'x':107.3,'y':480.9},{'x':100.5,'y':480.9},{'x':95.2,'y':494.6},{'x':93.6,'y':506.8},{'x':64.5,'y':513.1},{'x':43.9,'y':526.4},{'x':28.0,'y':487.2},{'x':14.3,'y':446.4},{'x':20.3,'y':437.4},{'x':12.1,'y':427.1},{'x':17.9,'y':424.5},{'x':18.8,'y':413.1},{'x':30.6,'y':412.6},{'x':57.6,'y':402.5},{'x':56.9,'y':390.4},{'x':49.1,'y':367.9},{'x':76.7,'y':325.3},{'x':72.7,'y':320.3},{'x':49.1,'y':320.3},{'x':30.6,'y':288.6},{'x':19.5,'y':279.3},{'x':19.3,'y':272.9},{'x':11.6,'y':258.9},{'x':16.9,'y':250.4},{'x':27.4,'y':249.3},{'x':27.2,'y':215.8},{'x':21.9,'y':206.3},{'x':14.8,'y':158.4},{'x':0.5,'y':138.3},{'x':1.0,'y':121.1},{'x':31.1,'y':95.2},{'x':49.1,'y':96.0},{'x':69.5,'y':112.1},{'x':89.3,'y':112.4},{'x':116.3,'y':121.9},{'x':143.6,'y':139.3},{'x':154.9,'y':131.7},{'x':153.3,'y':113.7},{'x':163.7,'y':111.8},{'x':172.9,'y':122.2},{'x':193.8,'y':114.5},{'x':207.1,'y':141.2},{'x':221.1,'y':114.8},{'x':221.3,'y':120.3},{'x':228.3,'y':119.3},{'x':238.1,'y':111.1},{'x':247.3,'y':115.6},{'x':252.3,'y':112.3},{'x':262.9,'y':115.3},{'x':269.8,'y':110.5},{'x':294.9,'y':121.6},{'x':349.4,'y':105.5},{'x':376.1,'y':104.7},{'x':385.9,'y':108.7},{'x':419.7,'y':129.6},{'x':460.7,'y':98.6},{'x':465.8,'y':102.8},{'x':484.8,'y':96.0},{'x':487.1,'y':86.2},{'x':503.6,'y':91.0},{'x':523.7,'y':89.9},{'x':537.1,'y':73.8},{'x':548.0,'y':83.0},{'x':563.1,'y':80.1},{'x':572.9,'y':69.0},{'x':589.5,'y':57.3},{'x':639.0,'y':58.4},{'x':644.4,'y':52.5},{'x':650.6,'y':56.0},{'x':672.6,'y':55.3},{'x':691.1,'y':39.6},{'x':692.0,'y':12.9},{'x':717.4,'y':0.5},{'x':735.0,'y':13.4},{'x':734.5,'y':34.0},{'x':742.1,'y':46.5},{'x':743.8,'y':64.2},{'x':763.0,'y':66.6},{'x':782.4,'y':56.3},{'x':797.8,'y':21.9},{'x':816.3,'y':21.9},{'x':822.6,'y':26.1},{'x':829.0,'y':27.2},{'x':859.6,'y':15.3},{'x':896.4,'y':36.2},{'x':905.4,'y':34.4},{'x':917.0,'y':41.5},{'x':920.7,'y':41.8},{'x':921.5,'y':46.3},{'x':929.7,'y':46.0},{'x':935.3,'y':48.4},{'x':936.6,'y':54.7},{'x':914.6,'y':83.3},{'x':911.2,'y':107.1},{'x':896.6,'y':155.3},{'x':863.0,'y':178.8},{'x':859.6,'y':186.9},{'x':854.0,'y':187.2},{'x':830.5,'y':216.3},{'x':831.6,'y':253.8},{'x':825.0,'y':256.3},{'x':813.4,'y':270.0},{'x':814.4,'y':301.5},{'x':809.4,'y':306.5},{'x':807.8,'y':310.4},{'x':803.9,'y':317.6},{'x':805.1,'y':325.8},{'x':801.2,'y':336.6},{'x':833.5,'y':334.3},{'x':851.5,'y':320.8},{'x':859.6,'y':315.5},{'x':899.6,'y':318.6},{'x':911.2,'y':334.1},{'x':900.6,'y':374.5},{'x':900.4,'y':415.8},{'x':890.9,'y':422.9},{'x':880.5,'y':421.9},{'x':874.5,'y':431.9},{'x':873.6,'y':438.5},{'x':878.5,'y':446.4},{'x':878.1,'y':455.7},{'x':870.5,'y':460.8},{'x':855.4,'y':454.6},{'x':839.3,'y':464.9},{'x':833.5,'y':481.6},{'x':836.6,'y':489.9},{'x':833.8,'y':497.5},{'x':821.5,'y':504.1},{'x':820.5,'y':559.4},{'x':814.7,'y':576.0},{'x':814.1,'y':591.6},{'x':834.8,'y':604.9},{'x':835.8,'y':609.4},{'x':839.3,'y':614.7},{'x':839.5,'y':643.3},{'x':835.8,'y':655.4},{'x':816.5,'y':672.9},{'x':799.5,'y':672.6},{'x':794.5,'y':676.9},{'x':791.1,'y':673.4},{'x':775.5,'y':678.2},{'x':778.4,'y':687.5},{'x':770.2,'y':690.6},{'x':752.0,'y':678.2},{'x':738.2,'y':703.3}],
    t:[],
    lang:langS['Ru'],
    sc:1,
    initialize: function (option) {
        this.t=this.scale(this.t3,1000*this.sc,1500*this.sc);


        this.t=this.getCutZero(this.t,this.getMaxMin(this.t));

//        for(var i=0;i<this.t.length;i++){
//            var t={};
//            t.x=this.t[i].x;
//            t.y=(maxY-arrAxces[i].y).toFixed(1);
//            resultArr[i]=t;
//        }
        this.t=this.transformInScreenAxesY(this.t,this.getMaxMin(this.t));


//        this.svgMS = this.getEl("svg").attr({"width":this.size[0],"height":this.size[1]}).hide();
//        $("body").append(this.svgMS);

        this.svgMC = this.getEl("svg").attr({"width":this.size[0]*this.sc,"height":this.size[1]*this.sc});
        this.svgMCP=$('<div style="position:absolute;z-index:5;left:0;top:0;width:'+this.size[0]*this.sc+'px;height:'+this.size[1]*this.sc+'px;">').append(this.svgMC);
        $("body").append(this.svgMCP);
        this.svgMC.append(this.drawPoligon(this.t));

        //-------рисовалка схематичной схемы
//        var maxMin=this.getMaxMin(this.t1);
//        this.svgMS.append(this.drawPoligon(this.transformInScreenAxesY(this.t1,maxMin)));
//        this.drawDepD3(this.svgMS,maxMin);
//        this.loadSt(this.svgMS,"_drawStD3");



//        this.panelUpravlenia();

        this.svgMF = this.getEl("svg").attr({"width":this.size[0]*this.sc,"height":this.size[1]*this.sc});
        this.svgMFP=$('<div style="position:absolute;z-index:10;left:0;top:0;width:'+this.size[0]*this.sc+'px;height:'+this.size[1]*this.sc+'px;">').append(this.svgMF);
        $("body").append(this.svgMFP);

        this.loadF(this.svgMF,"_drawF");
//        svg.attr({cx: 0,cy: 0, visible:'none'}).attr({cx: 0,cy: 0, visible:'visible'});
//            var txt='';
//            for(var i=0;i<this.t.length;i++) {
//                txt+="{'x':"+this.t[i].x+",'y':"+this.t[i].y+"},";
//            }
//        var el=$("#txt").css({'width':parseInt(this.maxX+1),'height':parseInt(this.maxY+1)});
//        this.drawMap(el);
//        this.drawDep(el);
//        var thisEl=this;
//        this.loadSt(el,"loadStEnd");

    },
    scale:function(arr,scaleX,scaleY){
        var arrR=[];
        for(var i=0;i<arr.length;i++){
            var obj=arr[i];
            obj.x=arr[i].x*scaleX;
            obj.y=arr[i].y*scaleY;
            arrR[i]=obj;
        }
        return arrR;
    },
    getCutZero:function(ar,maxmin){
        var ar2=[];
        for(var i=0;i<ar.length;i++){
            var obj=ar[i];
            obj.x=ar[i].x-maxmin.minX;
            obj.y=ar[i].y-maxmin.minY;
            ar2[i]=obj;
        }
        return ar2;
    },
    getEl:function(el){
        var xmlns = "http://www.w3.org/2000/svg";
        return $(document.createElementNS(xmlns,el));
    },
    loadSt:function(el,func){
        var thisEl=this;
        $.ajax({
            url: "/resources/images/games/_stations.xml",
            dataType:"xml"
        }).done(function( data ) {
            thisEl.loadStEnd(el,data,func);
        });
    },
    loadF:function(el,func){
        var thisEl=this;
        $.ajax({
            url: "/resources/images/games/map-st.osm.xml",
            dataType:"xml"
        }).done(function( data ) {
            thisEl[func](el,$(data));
        });
    },
    _drawF:function(el,data){
        //var sd=$(data).find('bounds');
        //var maxmin={'maxX':sd.attr('maxlon'),'maxY':sd.attr('maxlat'),'minX':sd.attr('minlon'),'minY':sd.attr('minlat')};
        var nodes=data.find('node');
        for(var i=0;i<nodes.length;i++){
            nodes[i].x=parseFloat(nodes[i].attributes['lon'].value);
            nodes[i].y=parseFloat(nodes[i].attributes['lat'].value);
            nodes[i].id=parseInt(nodes[i].attributes['id'].value);
        }
        var maxmin=this.getMaxMin(nodes);
        nodes=this.transformInScreenAxesY(nodes,maxmin);
        var maxmin=this.getMaxMin(nodes);
        nodes=this.getCutZero(nodes,maxmin);
        nodes=this.scale(nodes,100*this.sc,150*this.sc);
//        for(var i=0;i<nodes.length;i++){
//            $(nodes[i]).attr({'x':nodes[i].x,'y':nodes[i].y});
//        }
        maxmin=this.getMaxMin(nodes);
//        var ways=data.find('way:has(tag[k=railway])');
        var ways=data.find('way:has(tag[value=main])');

        var thisEl=this;
        this.infd=0;
        setTimeout(function(){thisEl.drawWays(el,data,ways, nodes);},1000);
    },
    drawWays:function(el,data,ways,nodes){
        var countL=100;
        for(var y=0;y<countL;y++){
            var i=this.infd;
            ways[i]=$(ways[i]);

            this.getPath2(nodes,ways[i]);
            if (ways[i].points!=null){
                if (ways[i].points[0].x == ways[i].points[ways[i].points.length - 1].x && ways[i].points[0].y == ways[i].points[ways[i].points.length - 1].y) {
                    el.append(this.drawPoligon(ways[i].points));
                } else {
                    el.append(this.drawPoligonF(ways[i].points, null, "black", "1"));
                }
            }
            delete ways[i];
            this.infd+=1;
        }
        var thisEl=this;
        if(this.infd<ways.length){
            setTimeout(function(){thisEl.drawWays(el,data,ways,nodes);},1);
        }
    },
    getPath2:function(nodes,way){
        var arr=way.find('nd');
        for(var i=0;i<arr.length;i++){
            var id=$(arr[i]).attr('ref');
            arr[i]={};
            arr[i].id=id;
        }

        var count=0;
        for(var i=0;i<nodes.length;i++){
            for(var y=0;y<arr.length;y++){
                if(nodes[i].id==arr[y].id){
                    arr[y]=nodes[i];
                    count++;
                }
            }
            if(arr.length==count){
                way.points=arr;
                return;
            }
        }
    },
    getPath:function(data,way){
        var arr=way.find('nd');
        way.points=[];
        for(var i=0;i<arr.length;i++){
            arr[i].point={};
            arr[i].point.tag=data.find('#'+$(arr[i]).attr('ref'));
            if(arr[i].point.tag.length==0){
                way.points=null;
                return;
            }
            arr[i].point.x=parseFloat(arr[i].point.tag.attr('x'));
            arr[i].point.y=parseFloat(arr[i].point.tag.attr('y'));
            arr[i].x=arr[i].point.x;
            arr[i].y=arr[i].point.y;
            way.points[i]=arr[i];
        }
    },
    loadStEnd:function(el,data,func){
        var arr=$(data).find('station');
        var arrObj=[];
        for(var i=0;i<arr.length;i++){
            var obj={};
            var ar=$(arr[i]);
            obj.name=ar.find('name').text();
            obj.esr=ar.find('esr').text();
            obj.sign=ar.find('sign').text();
            obj.dep=ar.find('dep').text();
            obj.x=parseInt(ar.find('x').text())-45;
            obj.y=parseInt(ar.find('y').text())-40;
            obj.angle=parseInt(ar.find('angle').text());
            arrObj[i]=obj;
        }
        this.stObj=arrObj;
        this[func](el,arrObj,8,'black',2,11);
    },
    _drawStD3:function(el,arrStEl,zind,color,type,typeSt){
        var thisEl=this;
        var lSt=this.getEl("g").attr("name","stations");
        el.append(lSt);
//        for(var i=0;i<arrStEl.length;i++){ var d=arrStEl[i];
//            lSt.append(this.getEl("g").attr({"transform":"translate(" + d.x + "," + d.y + ") rotate("+ d.angle+")"})
//                    .append(this.getEl("circle").attr({"r":((d.sign==11)?2:1),"style":"stroke:black;fill:white"}))
//                    .append(this.getEl("text").atr({"class":'st st'+ d.sign+' esr'+ d.esr,"style":"font-family:Arial; font-size:6;", "x":"2","y":"2"}).text(thisEl.getStName(d,type))));
//        }
        $(arrStEl).each(function(ind,d){
            lSt.append(thisEl.getEl("g").attr({"transform":"translate(" + d.x + "," + d.y + ") rotate("+ d.angle+")"})
                    .append(thisEl.getEl("circle").attr({"r":((d.sign==11)?2:1),"style":"stroke:black;fill:white"}))
                    .append(thisEl.getEl("text").attr({"class":'st st'+ d.sign+' esr'+ d.esr,"style":"font-family:Arial; font-size:6;", "x":"2","y":"2"}).text(thisEl.getStName(d,type))));
        })
    },
    getStName:function(d,type){
        if(type==null) return "";
        switch (type){
            case 0:return d.name;
            case 1:return d.esr;
            case 2:return "("+d.esr+") "+d.name;
        }
    },
    _drawSt:function(el,arrStEl,zind,color,type,typeSt){
        var st=$('<div>').css({'width':parseInt(this.maxX+1),'height':parseInt(this.maxY+1),'position':'absolute','z-index':zind,'top':0,'left':0});
        el.append(st);
        var imgSt=$('<canvas>');
        st.append(imgSt);
        var example = imgSt[0];
        example.width=parseInt(this.maxX+1);
        example.height=parseInt(this.maxY+1);
        var ctx = example.getContext('2d');
        //ctx.beginPath();

        for(var i=0;i< arrStEl.length;i++){
            ctx.translate(arrStEl[i].x, arrStEl[i].y);
            ctx.rotate((arrStEl[i].angle).degree());
            if(typeSt!=null){
                ctx.beginPath();
                if(arrStEl[i].sign==typeSt){
                    ctx.arc(3, 3, 3, 0, Math.PI * 2, false);
                }else{
                    ctx.arc(3, 3, 1, 0, Math.PI * 2, false);
                }
                ctx.closePath();
            }else{
                ctx.beginPath();
                ctx.arc(3, 3, 3, 0, Math.PI * 2, false);
                ctx.closePath();
            }

            if(typeSt==null || arrStEl[i].sign==typeSt){
                ctx.font = "bold 8px sans-serif";
                ctx.fillText(this.getStName(arrStEl[i],type), 8, 5);
            }
            ctx.fillStyle = color;
            ctx.stroke();//обводим
            ctx.save();
            ctx.rotate((360-arrStEl[i].angle).degree());
            ctx.translate(0-arrStEl[i].x, 0-arrStEl[i].y);
        }
//        ctx.closePath();
    },
    drawPoligon:function(obj) {
        return this.drawPoligonF(obj,"green","black","1");
    },
    drawPoligonF:function(obj,fillC,strokeC,strokeW) {
        if(fillC==null){fillC="transparent";}
        return this.getEl("path").attr({"d":this._drawPoligon(obj),"stroke":strokeC,"stroke-width":strokeW,fill:fillC});
    },
    _drawPoligon:function(arr){
        var ar='M'+arr[0].x+','+arr[0].y;
        for(var i=1;i<arr.length;i++){
            ar+= 'L'+arr[i].x+','+arr[i].y;
        }
        return ar;
    },
    drawMap:function(el){

        this.mapRBLayer=$('<div>').css({'width':parseInt(this.maxX+1),'height':parseInt(this.maxY+1),'position':'absolute','z-index':0,'top':0,'left':0});
        el.append(this.mapRBLayer);
        this.imgMapRB=$('<canvas>');
        this.mapRBLayer.append(this.imgMapRB);

        var example = this.imgMapRB[0];
        example.width=parseInt(this.maxX+1);
        example.height=parseInt(this.maxY+1);
        var ctx = example.getContext('2d');
//            ctx.translate(this.size[0]/2, this.size[1]);
//            ctx.rotate(180*Math.PI/180);
        ctx.beginPath();
        ctx.moveTo(this.t[0].x, this.t[0].y);
        for(var i=1;i< this.t.length;i++){
            ctx.lineTo(this.t[i].x, this.t[i].y);
        }
        ctx.closePath();
        var my_gradient = ctx.createLinearGradient(0, 0, 800, 800);
        my_gradient.addColorStop(0, "black");
        my_gradient.addColorStop(1, "gray");
        ctx.fillStyle = my_gradient;
//            ctx.fillRect(0, 0, 300, 225);
//            ctx.stroke();//обводим
        ctx.fill();//заливаем
    },
    drawDepD3:function(el,maxMin){
        var dep=this.getCordDep();
        for(var i=0;i<dep.length;i++){
            dep[i]=this.transformInScreenAxesY(dep[i],maxMin);
            el.append(this.getEl("path").attr({"d":this._drawPoligon(dep[i]),"stroke":"blue","stroke-width":"1","fill":"gray","class":"dep"}));
        }
    },
    getCordDep:function(){
        var dep=[];
        dep[0]=[{'x':776.9,'y':560.2},{'x':722.1,'y':562.0},{'x':705.4,'y':581.0},{'x':588.8,'y':580.5},{'x':516.0,'y':535.5},{'x':500.8,'y':542.7},{'x':484.1,'y':582.0},{'x':471.3,'y':577.5},{'x':307.6,'y':576.9},{'x':311.3,'y':567.0},{'x':311.0,'y':522.6},{'x':291.9,'y':516.0},{'x':305.3,'y':472.7},{'x':369.5,'y':401.2},{'x':381.0,'y':362.4},{'x':438.3,'y':297.1},{'x':537.8,'y':303.1},{'x':547.8,'y':309.1},{'x':570.3,'y':331.1},{'x':570.8,'y':389.6},{'x':711.8,'y':475.9},{'x':748.6,'y':478.1},{'x':756.4,'y':491.4},{'x':774.4,'y':502.4},{'x':821.5,'y':505.1},{'x':820.5,'y':559.4},{'x':814.7,'y':576.0},{'x':776.9,'y':560.2}];
        dep[1]=[{'x':93.6,'y':506.8},{'x':64.5,'y':513.1},{'x':43.9,'y':526.4},{'x':28.0,'y':487.2},{'x':14.3,'y':446.4},{'x':20.3,'y':437.4},{'x':12.1,'y':427.1},{'x':17.9,'y':424.5},{'x':18.8,'y':413.1},{'x':30.6,'y':412.6},{'x':57.6,'y':402.5},{'x':56.9,'y':390.4},{'x':49.1,'y':367.9},{'x':76.7,'y':325.3},{'x':72.7,'y':320.3},{'x':200.4,'y':320.1},{'x':311.5,'y':196.2},{'x':332.1,'y':183.8},{'x':361.4,'y':174.6},{'x':353.8,'y':154.8},{'x':383.4,'y':107.7},{'x':385.9,'y':108.7},{'x':419.7,'y':129.6},{'x':460.7,'y':98.6},{'x':465.8,'y':102.8},{'x':480.6,'y':97.5},{'x':493.6,'y':178.9},{'x':449.1,'y':185.1},{'x':437.6,'y':211.3},{'x':438.3,'y':297.1},{'x':381.0,'y':362.4},{'x':369.5,'y':401.2},{'x':305.3,'y':472.7},{'x':291.9,'y':516.0},{'x':277.7,'y':511.0},{'x':260.8,'y':512.0},{'x':249.2,'y':502.5},{'x':238.1,'y':505.7},{'x':228.5,'y':516.3},{'x':218.4,'y':519.5},{'x':193.6,'y':508.9},{'x':188.8,'y':495.6},{'x':179.3,'y':484.0},{'x':178.8,'y':477.1},{'x':164.5,'y':478.2},{'x':162.9,'y':468.6},{'x':150.8,'y':458.1},{'x':140.7,'y':455.9},{'x':124.8,'y':473.4},{'x':115.8,'y':473.9},{'x':107.3,'y':480.9},{'x':100.5,'y':480.9},{'x':95.2,'y':494.6},{'x':93.6,'y':506.8}];
        dep[2]=[{'x':332.1,'y':183.8},{'x':311.5,'y':196.2},{'x':200.4,'y':320.1},{'x':72.7,'y':320.3},{'x':49.1,'y':320.3},{'x':30.6,'y':288.6},{'x':19.5,'y':279.3},{'x':19.3,'y':272.9},{'x':11.6,'y':258.9},{'x':16.9,'y':250.4},{'x':27.4,'y':249.3},{'x':27.2,'y':215.8},{'x':21.9,'y':206.3},{'x':14.8,'y':158.4},{'x':0.5,'y':138.3},{'x':1.0,'y':121.1},{'x':31.1,'y':95.2},{'x':49.1,'y':96.0},{'x':69.5,'y':112.1},{'x':89.3,'y':112.4},{'x':116.3,'y':121.9},{'x':143.6,'y':139.3},{'x':154.9,'y':131.7},{'x':153.3,'y':113.7},{'x':163.7,'y':111.8},{'x':172.9,'y':122.2},{'x':193.8,'y':114.5},{'x':207.1,'y':141.2},{'x':221.1,'y':114.8},{'x':221.3,'y':120.3},{'x':228.3,'y':119.3},{'x':238.1,'y':111.1},{'x':247.3,'y':115.6},{'x':252.3,'y':112.3},{'x':262.9,'y':115.3},{'x':269.8,'y':110.5},{'x':294.9,'y':121.6},{'x':349.4,'y':105.5},{'x':376.1,'y':104.7},{'x':383.4,'y':107.7},{'x':353.8,'y':154.8},{'x':361.4,'y':174.6},{'x':332.1,'y':183.8}];
        dep[3]=[{'x':807.8,'y':310.4},{'x':806.4,'y':313.0},{'x':685.1,'y':313.4},{'x':686.6,'y':196.3},{'x':660.4,'y':172.6},{'x':493.6,'y':178.9},{'x':480.6,'y':97.5},{'x':484.8,'y':96.0},{'x':487.1,'y':86.2},{'x':503.6,'y':91.0},{'x':523.7,'y':89.9},{'x':537.1,'y':73.8},{'x':548.0,'y':83.0},{'x':563.1,'y':80.1},{'x':572.9,'y':69.0},{'x':589.5,'y':57.3},{'x':639.0,'y':58.4},{'x':644.4,'y':52.5},{'x':650.6,'y':56.0},{'x':672.6,'y':55.3},{'x':691.1,'y':39.6},{'x':692.0,'y':12.9},{'x':717.4,'y':0.5},{'x':735.0,'y':13.4},{'x':734.5,'y':34.0},{'x':742.1,'y':46.5},{'x':743.8,'y':64.2},{'x':763.0,'y':66.6},{'x':782.4,'y':56.3},{'x':797.8,'y':21.9},{'x':816.3,'y':21.9},{'x':822.6,'y':26.1},{'x':829.0,'y':27.2},{'x':859.6,'y':15.3},{'x':896.4,'y':36.2},{'x':905.4,'y':34.4},{'x':917.0,'y':41.5},{'x':920.7,'y':41.8},{'x':921.5,'y':46.3},{'x':929.7,'y':46.0},{'x':935.3,'y':48.4},{'x':936.6,'y':54.7},{'x':914.6,'y':83.3},{'x':911.2,'y':107.1},{'x':896.6,'y':155.3},{'x':863.0,'y':178.8},{'x':859.6,'y':186.9},{'x':854.0,'y':187.2},{'x':830.5,'y':216.3},{'x':831.6,'y':253.8},{'x':825.0,'y':256.3},{'x':813.4,'y':270.0},{'x':814.4,'y':301.5},{'x':809.4,'y':306.5},{'x':807.8,'y':310.4}];
        dep[4]=[{'x':748.6,'y':478.1},{'x':711.8,'y':475.9},{'x':570.8,'y':389.6},{'x':570.3,'y':331.1},{'x':547.8,'y':309.1},{'x':537.8,'y':303.1},{'x':438.3,'y':297.1},{'x':437.6,'y':211.3},{'x':449.1,'y':185.1},{'x':493.6,'y':178.9},{'x':660.4,'y':172.6},{'x':686.6,'y':196.3},{'x':685.1,'y':313.4},{'x':806.4,'y':313.0},{'x':803.9,'y':317.6},{'x':805.1,'y':325.8},{'x':801.2,'y':336.6},{'x':833.5,'y':334.3},{'x':851.5,'y':320.8},{'x':859.6,'y':315.5},{'x':899.6,'y':318.6},{'x':911.2,'y':334.1},{'x':900.6,'y':374.5},{'x':900.4,'y':415.8},{'x':890.9,'y':422.9},{'x':880.5,'y':421.9},{'x':874.5,'y':431.9},{'x':873.6,'y':438.5},{'x':878.5,'y':446.4},{'x':878.1,'y':455.7},{'x':870.5,'y':460.8},{'x':855.4,'y':454.6},{'x':839.3,'y':464.9},{'x':833.5,'y':481.6},{'x':836.6,'y':489.9},{'x':833.8,'y':497.5},{'x':821.5,'y':504.1},{'x':821.5,'y':505.1},{'x':774.4,'y':502.4},{'x':756.4,'y':491.4},{'x':748.6,'y':478.1}];
        dep[5]=[{'x':752.0,'y':678.2},{'x':738.2,'y':703.3},{'x':713.4,'y':703.9},{'x':703.8,'y':700.6},{'x':697.5,'y':705.7},{'x':686.1,'y':706.8},{'x':680.3,'y':714.7},{'x':672.6,'y':715.2},{'x':670.0,'y':703.5},{'x':664.1,'y':690.4},{'x':651.7,'y':705.4},{'x':642.2,'y':688.0},{'x':636.6,'y':686.4},{'x':632.6,'y':679.2},{'x':620.2,'y':679.5},{'x':618.1,'y':683.1},{'x':606.2,'y':691.4},{'x':581.1,'y':692.1},{'x':573.6,'y':683.5},{'x':563.1,'y':672.9},{'x':549.4,'y':674.5},{'x':536.1,'y':672.3},{'x':517.4,'y':653.3},{'x':518.1,'y':625.5},{'x':512.0,'y':616.8},{'x':501.2,'y':620.2},{'x':499.9,'y':616.5},{'x':487.4,'y':620.5},{'x':477.6,'y':638.5},{'x':466.3,'y':636.6},{'x':454.1,'y':636.1},{'x':447.5,'y':632.4},{'x':440.9,'y':633.2},{'x':436.6,'y':629.8},{'x':418.9,'y':652.5},{'x':408.1,'y':653.6},{'x':402.8,'y':643.8},{'x':397.3,'y':644.0},{'x':392.4,'y':634.5},{'x':386.6,'y':634.3},{'x':381.9,'y':624.5},{'x':371.9,'y':619.5},{'x':361.3,'y':618.9},{'x':343.3,'y':615.0},{'x':314.7,'y':593.8},{'x':307.6,'y':576.9},{'x':471.3,'y':577.5},{'x':484.1,'y':582.0},{'x':500.8,'y':542.7},{'x':516.0,'y':535.5},{'x':588.8,'y':580.5},{'x':705.4,'y':581.0},{'x':722.1,'y':562.0},{'x':776.9,'y':560.2},{'x':814.7,'y':576.0},{'x':814.1,'y':591.6},{'x':834.8,'y':604.9},{'x':835.8,'y':609.4},{'x':839.3,'y':614.7},{'x':839.5,'y':643.3},{'x':835.8,'y':655.4},{'x':816.5,'y':672.9},{'x':799.5,'y':672.6},{'x':794.5,'y':676.9},{'x':791.1,'y':673.4},{'x':775.5,'y':678.2},{'x':778.4,'y':687.5},{'x':770.2,'y':690.6},{'x':752.0,'y':678.2}];
        return dep;
    },
    drawDep:function(el,maxMin){
        var dep=this.getCordDep();
        var thisEl=this;
        for(var i=0;i<dep.length;i++){
            dep[i]=this.transformInScreenAxesY(dep[i],maxMin);
            this._drawDep(el,dep[i],5,'orange');
        }
    },
    _drawNO:function(maxMin){
        var nep2=[];
        nep2[0]=[{'x':814.7,'y':576.0},{'x':776.9,'y':560.2},{'x':722.1,'y':562.0},{'x':705.4,'y':581.0},{'x':588.8,'y':580.5},{'x':516.0,'y':535.5},{'x':500.8,'y':542.7},{'x':484.1,'y':582.0},{'x':471.3,'y':577.5},{'x':307.6,'y':576.9}];
        nep2[1]=[{'x':821.5,'y':505.1},{'x':774.4,'y':502.4},{'x':756.4,'y':491.4},{'x':748.6,'y':478.1},{'x':711.8,'y':475.9},{'x':570.8,'y':389.6},{'x':570.3,'y':331.1},{'x':547.8,'y':309.1},{'x':537.8,'y':303.1},{'x':438.3,'y':297.1}];
        nep2[2]=[{'x':821.5,'y':505.1},{'x':820.5,'y':559.4},{'x':814.7,'y':576.0}];
        nep2[3]=[{'x':806.4,'y':313.0},{'x':803.9,'y':317.6},{'x':805.1,'y':325.8},{'x':801.2,'y':336.6},{'x':833.5,'y':334.3},{'x':851.5,'y':320.8},{'x':859.6,'y':315.5},{'x':899.6,'y':318.6},{'x':911.2,'y':334.1},{'x':900.6,'y':374.5},{'x':900.4,'y':415.8},{'x':890.9,'y':422.9},{'x':880.5,'y':421.9},{'x':874.5,'y':431.9},{'x':873.6,'y':438.5},{'x':878.5,'y':446.4},{'x':878.1,'y':455.7},{'x':870.5,'y':460.8},{'x':855.4,'y':454.6},{'x':839.3,'y':464.9},{'x':833.5,'y':481.6},{'x':836.6,'y':489.9},{'x':833.8,'y':497.5},{'x':821.5,'y':504.1},{'x':821.5,'y':505.1}];
        nep2[4]=[{'x':291.9,'y':516.0},{'x':277.7,'y':511.0},{'x':260.8,'y':512.0},{'x':249.2,'y':502.5},{'x':238.1,'y':505.7},{'x':228.5,'y':516.3},{'x':218.4,'y':519.5},{'x':193.6,'y':508.9},{'x':188.8,'y':495.6},{'x':179.3,'y':484.0},{'x':178.8,'y':477.1},{'x':164.5,'y':478.2},{'x':162.9,'y':468.6},{'x':150.8,'y':458.1},{'x':140.7,'y':455.9},{'x':124.8,'y':473.4},{'x':115.8,'y':473.9},{'x':107.3,'y':480.9},{'x':100.5,'y':480.9},{'x':95.2,'y':494.6},{'x':93.6,'y':506.8},{'x':64.5,'y':513.1},{'x':43.9,'y':526.4},{'x':28.0,'y':487.2},{'x':14.3,'y':446.4},{'x':20.3,'y':437.4},{'x':12.1,'y':427.1},{'x':17.9,'y':424.5},{'x':18.8,'y':413.1},{'x':30.6,'y':412.6},{'x':57.6,'y':402.5},{'x':56.9,'y':390.4},{'x':49.1,'y':367.9},{'x':76.7,'y':325.3},{'x':72.7,'y':320.3}];
        nep2[5]=[{'x':307.6,'y':576.9},{'x':311.3,'y':567.0},{'x':311.0,'y':522.6},{'x':291.9,'y':516.0}];
        nep2[6]=[{'x':291.9,'y':516.0},{'x':305.3,'y':472.7},{'x':369.5,'y':401.2},{'x':381.0,'y':362.4},{'x':438.3,'y':297.1}];
        nep2[7]=[{'x':383.4,'y':107.7},{'x':353.8,'y':154.8},{'x':361.4,'y':174.6},{'x':332.1,'y':183.8},{'x':311.5,'y':196.2}];
        nep2[8]=[{'x':438.3,'y':297.1},{'x':437.6,'y':211.3},{'x':449.1,'y':185.1},{'x':493.6,'y':178.9}];
        nep2[9]=[{'x':72.7,'y':320.3},{'x':49.1,'y':320.3},{'x':30.6,'y':288.6},{'x':19.5,'y':279.3},{'x':19.3,'y':272.9},{'x':11.6,'y':258.9},{'x':16.9,'y':250.4},{'x':27.4,'y':249.3},{'x':27.2,'y':215.8},{'x':21.9,'y':206.3},{'x':14.8,'y':158.4},{'x':0.5,'y':138.3},{'x':1.0,'y':121.1},{'x':31.1,'y':95.2},{'x':49.1,'y':96.0},{'x':69.5,'y':112.1},{'x':89.3,'y':112.4},{'x':116.3,'y':121.9},{'x':143.6,'y':139.3},{'x':154.9,'y':131.7},{'x':153.3,'y':113.7},{'x':163.7,'y':111.8},{'x':172.9,'y':122.2},{'x':193.8,'y':114.5},{'x':207.1,'y':141.2},{'x':221.1,'y':114.8},{'x':221.3,'y':120.3},{'x':228.3,'y':119.3},{'x':238.1,'y':111.1},{'x':247.3,'y':115.6},{'x':252.3,'y':112.3},{'x':262.9,'y':115.3},{'x':269.8,'y':110.5},{'x':294.9,'y':121.6},{'x':349.4,'y':105.5},{'x':376.1,'y':104.7},{'x':383.4,'y':107.7},{'x':385.9,'y':108.7},{'x':419.7,'y':129.6},{'x':460.7,'y':98.6},{'x':465.8,'y':102.8},{'x':480.6,'y':97.5}];
        nep2[10]=[{'x':72.7,'y':320.3},{'x':200.4,'y':320.1},{'x':311.5,'y':196.2}];
        nep2[11]=[{'x':480.6,'y':97.5},{'x':484.8,'y':96.0},{'x':487.1,'y':86.2},{'x':503.6,'y':91.0},{'x':523.7,'y':89.9},{'x':537.1,'y':73.8},{'x':548.0,'y':83.0},{'x':563.1,'y':80.1},{'x':572.9,'y':69.0},{'x':589.5,'y':57.3},{'x':639.0,'y':58.4},{'x':644.4,'y':52.5},{'x':650.6,'y':56.0},{'x':672.6,'y':55.3},{'x':691.1,'y':39.6},{'x':692.0,'y':12.9},{'x':717.4,'y':0.5},{'x':735.0,'y':13.4},{'x':734.5,'y':34.0},{'x':742.1,'y':46.5},{'x':743.8,'y':64.2},{'x':763.0,'y':66.6},{'x':782.4,'y':56.3},{'x':797.8,'y':21.9},{'x':816.3,'y':21.9},{'x':822.6,'y':26.1},{'x':829.0,'y':27.2},{'x':859.6,'y':15.3},{'x':896.4,'y':36.2},{'x':905.4,'y':34.4},{'x':917.0,'y':41.5},{'x':920.7,'y':41.8},{'x':921.5,'y':46.3},{'x':929.7,'y':46.0},{'x':935.3,'y':48.4},{'x':936.6,'y':54.7},{'x':914.6,'y':83.3},{'x':911.2,'y':107.1},{'x':896.6,'y':155.3},{'x':863.0,'y':178.8},{'x':859.6,'y':186.9},{'x':854.0,'y':187.2},{'x':830.5,'y':216.3},{'x':831.6,'y':253.8},{'x':825.0,'y':256.3},{'x':813.4,'y':270.0},{'x':814.4,'y':301.5},{'x':809.4,'y':306.5},{'x':807.8,'y':310.4},{'x':806.4,'y':313.0}];
        nep2[12]=[{'x':806.4,'y':313.0},{'x':685.1,'y':313.4},{'x':686.6,'y':196.3},{'x':660.4,'y':172.6},{'x':493.6,'y':178.9}];
        nep2[13]=[{'x':814.7,'y':576.0},{'x':814.1,'y':591.6},{'x':834.8,'y':604.9},{'x':835.8,'y':609.4},{'x':839.3,'y':614.7},{'x':839.5,'y':643.3},{'x':835.8,'y':655.4},{'x':816.5,'y':672.9},{'x':799.5,'y':672.6},{'x':794.5,'y':676.9},{'x':791.1,'y':673.4},{'x':775.5,'y':678.2},{'x':778.4,'y':687.5},{'x':770.2,'y':690.6},{'x':752.0,'y':678.2},{'x':738.2,'y':703.3},{'x':713.4,'y':703.9},{'x':703.8,'y':700.6},{'x':697.5,'y':705.7},{'x':686.1,'y':706.8},{'x':680.3,'y':714.7},{'x':672.6,'y':715.2},{'x':670.0,'y':703.5},{'x':664.1,'y':690.4},{'x':651.7,'y':705.4},{'x':642.2,'y':688.0},{'x':636.6,'y':686.4},{'x':632.6,'y':679.2},{'x':620.2,'y':679.5},{'x':618.1,'y':683.1},{'x':606.2,'y':691.4},{'x':581.1,'y':692.1},{'x':573.6,'y':683.5},{'x':563.1,'y':672.9},{'x':549.4,'y':674.5},{'x':536.1,'y':672.3},{'x':517.4,'y':653.3},{'x':518.1,'y':625.5},{'x':512.0,'y':616.8},{'x':501.2,'y':620.2},{'x':499.9,'y':616.5},{'x':487.4,'y':620.5},{'x':477.6,'y':638.5},{'x':466.3,'y':636.6},{'x':454.1,'y':636.1},{'x':447.5,'y':632.4},{'x':440.9,'y':633.2},{'x':436.6,'y':629.8},{'x':418.9,'y':652.5},{'x':408.1,'y':653.6},{'x':402.8,'y':643.8},{'x':397.3,'y':644.0},{'x':392.4,'y':634.5},{'x':386.6,'y':634.3},{'x':381.9,'y':624.5},{'x':371.9,'y':619.5},{'x':361.3,'y':618.9},{'x':343.3,'y':615.0},{'x':314.7,'y':593.8},{'x':307.6,'y':576.9}];

        var tttj=function(ind){return function(){thisEl._drawDep(el,nep2[ind],7+ind,'red');}}

        for(var i=0;i<nep2.length;i++){
            nep2[i]=this.transformInScreenAxesY(nep2[i],maxMin);
            setTimeout(tttj(i),i*3000);
        }
    },
    _drawDep:function(el,dep2,zind,color){
        var dep=$('<div>').css({'width':parseInt(this.maxX+1),'height':parseInt(this.maxY+1),'position':'absolute','z-index':zind,'top':0,'left':0});
        el.append(dep);
        var imgDep=$('<canvas>');
        dep.append(imgDep);
        var example2 = imgDep[0];
        example2.width=parseInt(this.maxX+1);
        example2.height=parseInt(this.maxY+1);
        var ctx2 = example2.getContext('2d');
        ctx2.beginPath();
        ctx2.moveTo(dep2[0].x, dep2[0].y);
        for(var i=1;i< dep2.length;i++){
            ctx2.lineTo(dep2[i].x, dep2[i].y);
        }

        ctx2.closePath();
        ctx2.stroke();

        ctx2.fillStyle = color;
        ctx2.fill();//обводим

    },
    getMaxMin:function(arr){
        var maxX=0;
        var maxY=0;
        var minX=arr[0].x;
        var minY=arr[0].y;
        for(var i=0;i<arr.length;i++){
            if(maxX<arr[i].x){
                maxX=arr[i].x;
            }
            if(maxY<arr[i].y){
                maxY=arr[i].y;
            }
            if(minX>arr[i].x){
                minX=arr[i].x;
            }
            if(minY>arr[i].y){
                minY=arr[i].y;
            }

        }
        return {'maxX':maxX,'maxY':maxY,'minX':minX,'minY':minY};
    },
    transformInScreenAxesY:function(arrAxces,maxMin){
        var ar2=[];
        for(var i=0;i<arrAxces.length;i++){
            var t={};
            t.x=arrAxces[i].x;
            t.y=maxMin.maxY-arrAxces[i].y;
            ar2[i]=arrAxces[i];
            ar2[i].x=t.x;
            ar2[i].y=t.y;
        }
        return ar2;
    },
    changeNameSt:function(){
        var type=null;
        var chs=this.chs;
        if(chs[5][0].checked & chs[6][0].checked){
            type=2;
        }else{
            if(chs[5][0].checked & !chs[6][0].checked){
                type=0;
            }
            if(!chs[5][0].checked & chs[6][0].checked){
                type=1;
            }
        }
        for(var i=0;i<this.stObj.length;i++){
            $('.st.esr'+this.stObj[i].esr).text(this.getStName(this.stObj[i],type)) ;
        }
    },
    panelUpravlenia:function(){
        var thisEl=this;
        var ch1=$('<input type="checkbox" checked="checked"/>').change(function(e){$('.dep').toggle(e.target.checked);});
        var ch2=$('<input type="checkbox" checked="checked"/>').change(function(e){$('.st11').toggle(e.target.checked);});
        var ch3=$('<input type="checkbox" checked="checked"/>').change(function(e){$('.st10').toggle(e.target.checked);});
        var ch4=$('<input type="checkbox" name="chSt" checked="checked"/>').change(function(){thisEl.changeNameSt()});
        var ch5=$('<input type="checkbox" name="chEsr" checked="checked"/>').change(function(){thisEl.changeNameSt()});

        var ch6=$('<input type="radio" name="chSM" checked="checked"/>').change(function(){thisEl.svgMS.hide();thisEl.svgMCP.show(); $(thisEl.chs).each(function(ind, el){if(ind!=0 & ind!=1){el.attr('disabled','disabled');}})});
        var ch7=$('<input type="radio" name="chSM" />').change(function(){thisEl.svgMCP.hide();thisEl.svgMS.show();$(thisEl.chs).each(function(ind, el){if(ind!=0 & ind!=1){el.removeAttr('disabled');}})});
        this.chs=[ch6,ch7,ch1,ch2,ch3,ch4,ch5]; var chsL=["SHOW_KORD_MAP","SHOW_SHEM_MAP","SHOW_EDGE_DEP","SHOW_SORT_ST","SHOW_OTHER_ST","SHOW_NAME","SHOW_ESR"];
        var d=$('<div style="position: absolute;z-index:10;top:0;left:0;">');
        $(this.chs).each(function(ind, el){if(ind!=0 & ind!=1){el.attr('disabled','disabled');};d.append($('<div>').append(el).append($('<label>').text(thisEl.lang[chsL[ind]])));});
        $('body').append(d);
    }
}

$(function(){
//    var data=new Date();
    new LayerMapRB();
//    var dataE=new Date();
//    $('body').append($('<div style="position:absolute;z-index: 5;top:10px;left: 300px;">').text(dataE.getTime()-data.getTime()));
});

</script>
</body>
</html>